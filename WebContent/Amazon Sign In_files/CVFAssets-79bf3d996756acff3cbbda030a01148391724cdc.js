P.register("cvfVersion",function(){return{version:"0.1.0.0-2017-06-13"}});
P.when("A","cvfVersion","cvfFormDataGenerator","ready").register("cvf",function(n,r,A){function l(d){function h(a){l.options.spinnerTarget&&l.options.spinnerTarget.hide();a.hasOwnProperty("error")?n.trigger(z.error,a.error):a.redirect?(n.trigger(z.success,a.token,a.status,a.redirect),l.options.autoDestroy?l.destroy():(k(".cvf-widget-alert").hide(),a.status?k(".cvf-widget-status-success").show():k(".cvf-widget-status-error").show(),t()),n.trigger("cvf:verification:complete",a.status),x.find(".cvf-widget-btn").unbind("click",
b),x.find(".cvf-widget-btn-val").unbind("click",b),n.off(z.success),n.off(z.error)):(x.html(a.replace(/<form/g,"<div").replace(/<\/form/g,"</div")),c())}function b(a,c){a.preventDefault();k(".cvf-widget-alert").hide();l.options.spinnerTarget&&l.options.spinnerTarget.show();var b=A.retrieveFormData(a.target),d=b.inputData.serializeArray();c&&d.push(A.getNameValue(a.target));n.ajax(B+b.requestPath,{method:"POST",params:d,success:h,error:u})}function a(a){13===a.keyCode&&b(a)}function c(){x.find(".cvf-widget-btn").click(function(a){b(a,
!1)});x.find(".cvf-widget-btn-val").click(function(a){b(a,!0)});x.find('input[name="code"]').focus().keypress(a)}function p(a){return function(c,b,d){"timeout"!==b||3<=y?n.trigger(z.error,d):n.delay(a,10*y++)}}function u(a,c,b){l.options.spinnerTarget&&l.options.spinnerTarget.hide();n.trigger(z.error,b)}function t(){k.each(x.find("input"),function(a,c){var b=k(c);b.attr("disabled","disabled");b.hasClass("a-input-text")?b.addClass("a-form-disabled"):b.hasClass("a-button-input")?b.closest(".a-button").addClass("a-button-disabled"):
b.closest(".a-input-text-wrapper").length&&b.closest(".a-input-text-wrapper").addClass("a-form-disabled")});k.each(x.find("a"),function(a,c){var b=k(c);b.hasClass("cvf-widget-link-disable-target")&&b.addClass("cvf-link-disabled")})}var l=this;e++;var z={success:"cvf:"+e+":success",error:"cvf:"+e+":error"};l.options={};k.extend(l.options,f,d);(function(a){if(1!==k(a.target).length)throw Error("The CVF widget requires a unique element.");if(!k.isFunction(a.onSuccess))throw Error("The CVF widget requires a success callback function.");
if(!k.isFunction(a.onError))throw Error("The CVF widget requires an error callback function.");})(l.options);var B=l.options.server,x=k(l.options.target);n.on(z.success,l.options.onSuccess);n.on(z.error,l.options.onError);l.start=function(){if(0===k.trim(l.options.requestToken).length)throw Error("The CVF widget requires a request token.");n.ajax(B+"/ap/cvf/request.embed?requestToken="+l.options.requestToken,{method:"GET",params:g,success:h,error:p(l.start)})};l.destroy=function(){x.html("")};c();
var y=0;l.options.autoStart&&l.start()}function h(d){return new l(d)}var k=n.$,f={server:"",target:void 0,requestToken:void 0,onSuccess:void 0,onError:void 0,spinnerTarget:void 0,autoStart:!0,autoDestroy:!0},e=0,g=[{name:"CVFVersion",value:r.version},{name:"AUIVersion",value:P.AUI_BUILD_DATE}];n.on("cvf:verification:request",function(d){var e=k("#"+d),b=e.data("token"),a=e.data("spinnerId"),a=k("#"+a);h({target:e,spinnerTarget:a,requestToken:b,onSuccess:function(a,b,e){n.trigger("cvf:verification:complete:"+
d,a,b,e)},onError:function(a){n.trigger("cvf:verification:error:"+d,a)},autoStart:!0,autoDestroy:!1})});return{create:h}});
P.when("A","cvf","ready").execute(function(n,r){var A=n.$;A(document).ready(function(){function l(e,d,f){window.location=f;console.log("Client Side: "+e)}function h(e){console.log(e)}var k=A(".cvf-widget-spinner"),f=A("#cvf-widget-content");if(1===f.length){var e=A('[name="requestToken"]').first().attr("value");r.create({target:f,spinnerTarget:k,requestToken:e,onSuccess:l,onError:h,autoStart:!1})}})});
P.when("A").execute(function(n){n.declarative("auth-popup","click",function(n){var A=n.data;n=n.$target.closest("a")[0];(A=window.open(n.href,n.target,A.windowOptions))&&A.focus()})});P.when("A","cvfFormDataGenerator","ready").execute(function(n,r){});
P.when("A","cvfFormDataGenerator","ready").execute(function(n,r){var A=n.$;A(".cvf-widget-btn-val").click(function(l){var h=A(l.target).closest(".cvf-widget-form");l=r.getNameValue(A(l.target));h.append('<input type="hidden" name="'+l.name+'" value="'+l.value+'">').submit()})});
P.when("A","ready").register("cvfFormDataGenerator",function(n){var r=n.$;return{retrieveFormData:function(n){n=r(n).closest(".cvf-widget-form");return{requestPath:"/ap/cvf/"+n.attr("action")+".embed",inputData:n.find(".cvf-widget-input,.cvf-widget-hidden-fields,.cvf-widget-input :input"),form:n}},getNameValue:function(n){n=r(n);var l=n.attr("name");l||(l=n.closest(".cvf-widget-btn-val").attr("data-name"));var h=n.attr("value");h||(h=n.closest(".cvf-widget-btn-val").attr("data-value"));return{name:l,
value:h}}}});